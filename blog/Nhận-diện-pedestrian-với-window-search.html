<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Nhận diện pedestrian với window search | ThorPham</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://thorpham.github.io/blog/Nhận-diện-pedestrian-với-window-search"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Nhận diện pedestrian với window search | ThorPham"><meta data-rh="true" name="description" content="Object regconite bao gồm 2 phần việc đó là object classifier và  object detection. Hiểu một cách đơn giản đó là nếu chúng ta muốn máy tính nhận dạng được con mèo hay con chó thì trước tiên nó sẽ phải detecter đối tượng đó trên image và sau đó xem đối tượng đó là cái gì bằng cách classifier .Với sự phát triển của deep learning như hiện nay đã có rất nhiều thuật toán giúp ta giải quyết vấn đề này như R-CNN,Fast or Faster R-CNN,YOLO hay SSD với tốc độ xử lý nhanh và độ chính xác cao. Tuy vậy những cách truyền thống vẫn là sự lựa chon tốt khi mà chúng ta có ít dữ liệu và muốn build một model nào đó đơn giản hơn những cái phức tạp hơn như deep learning. Trong bài này chúng ta sẽ nhận diện pedestrian bằng phương pháp cổ điển trong computer vision và sau đó bạn có thể tự build một model custom nào đó theo ý của bạn .Thuật toán sử dụng trong bài là HOG + SVM + Window search."><meta data-rh="true" property="og:description" content="Object regconite bao gồm 2 phần việc đó là object classifier và  object detection. Hiểu một cách đơn giản đó là nếu chúng ta muốn máy tính nhận dạng được con mèo hay con chó thì trước tiên nó sẽ phải detecter đối tượng đó trên image và sau đó xem đối tượng đó là cái gì bằng cách classifier .Với sự phát triển của deep learning như hiện nay đã có rất nhiều thuật toán giúp ta giải quyết vấn đề này như R-CNN,Fast or Faster R-CNN,YOLO hay SSD với tốc độ xử lý nhanh và độ chính xác cao. Tuy vậy những cách truyền thống vẫn là sự lựa chon tốt khi mà chúng ta có ít dữ liệu và muốn build một model nào đó đơn giản hơn những cái phức tạp hơn như deep learning. Trong bài này chúng ta sẽ nhận diện pedestrian bằng phương pháp cổ điển trong computer vision và sau đó bạn có thể tự build một model custom nào đó theo ý của bạn .Thuật toán sử dụng trong bài là HOG + SVM + Window search."><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2018-04-11T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/ThorPham"><meta data-rh="true" property="article:tag" content="opencv,python,computer vision"><link data-rh="true" rel="icon" href="/img/emoticon_big.png"><link data-rh="true" rel="canonical" href="https://thorpham.github.io/blog/Nhận-diện-pedestrian-với-window-search"><link data-rh="true" rel="alternate" href="https://thorpham.github.io/blog/Nhận-diện-pedestrian-với-window-search" hreflang="en"><link data-rh="true" rel="alternate" href="https://thorpham.github.io/blog/Nhận-diện-pedestrian-với-window-search" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://thorpham.github.io/blog/Nhận-diện-pedestrian-với-window-search","mainEntityOfPage":"https://thorpham.github.io/blog/Nhận-diện-pedestrian-với-window-search","url":"https://thorpham.github.io/blog/Nhận-diện-pedestrian-với-window-search","headline":"Nhận diện pedestrian với window search","name":"Nhận diện pedestrian với window search","description":"Object regconite bao gồm 2 phần việc đó là object classifier và  object detection. Hiểu một cách đơn giản đó là nếu chúng ta muốn máy tính nhận dạng được con mèo hay con chó thì trước tiên nó sẽ phải detecter đối tượng đó trên image và sau đó xem đối tượng đó là cái gì bằng cách classifier .Với sự phát triển của deep learning như hiện nay đã có rất nhiều thuật toán giúp ta giải quyết vấn đề này như R-CNN,Fast or Faster R-CNN,YOLO hay SSD với tốc độ xử lý nhanh và độ chính xác cao. Tuy vậy những cách truyền thống vẫn là sự lựa chon tốt khi mà chúng ta có ít dữ liệu và muốn build một model nào đó đơn giản hơn những cái phức tạp hơn như deep learning. Trong bài này chúng ta sẽ nhận diện pedestrian bằng phương pháp cổ điển trong computer vision và sau đó bạn có thể tự build một model custom nào đó theo ý của bạn .Thuật toán sử dụng trong bài là HOG + SVM + Window search.","datePublished":"2018-04-11T00:00:00.000Z","author":{"@type":"Person","name":"Thorpham","description":"Deep learning enthusiast","url":"https://github.com/ThorPham","image":"https://github.com/ThorPham.png"},"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://thorpham.github.io/blog","name":"Blog"}}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="ThorPham RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="ThorPham Atom Feed">





<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.81292009.css">
<script src="/assets/js/runtime~main.367e03ce.js" defer="defer"></script>
<script src="/assets/js/main.be6f4518.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/emoticon_big.png" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/emoticon_big.png" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Thorpham</b></a><a class="navbar__item navbar__link" href="/cs/intro">CS</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/ThorPham" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><main class="col col--9 col--offset-1"><article class=""><header><h1 class="title_f1Hy">Nhận diện pedestrian với window search</h1><div class="container_mt6G margin-vert--md"><time datetime="2018-04-11T00:00:00.000Z">April 11, 2018</time> · <!-- -->9 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/ThorPham" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://github.com/ThorPham.png" alt="Thorpham"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://github.com/ThorPham" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">Thorpham</span></a></div><small class="authorTitle_nd0D" title="Deep learning enthusiast">Deep learning enthusiast</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div id="__blog-post-container" class="markdown"><p><em>Object regconite bao gồm 2 phần việc đó là object classifier và  object detection. Hiểu một cách đơn giản đó là nếu chúng ta muốn máy tính nhận dạng được con mèo hay con chó thì trước tiên nó sẽ phải detecter đối tượng đó trên image và sau đó xem đối tượng đó là cái gì bằng cách classifier .Với sự phát triển của deep learning như hiện nay đã có rất nhiều thuật toán giúp ta giải quyết vấn đề này như R-CNN,Fast or Faster R-CNN,YOLO hay SSD với tốc độ xử lý nhanh và độ chính xác cao. Tuy vậy những cách truyền thống vẫn là sự lựa chon tốt khi mà chúng ta có ít dữ liệu và muốn build một model nào đó đơn giản hơn những cái phức tạp hơn như deep learning. Trong bài này chúng ta sẽ nhận diện pedestrian bằng phương pháp cổ điển trong computer vision và sau đó bạn có thể tự build một model custom nào đó theo ý của bạn .Thuật toán sử dụng trong bài là HOG + SVM + Window search.</em></p>
<p>Cách bước thực hiện ta chia làm 2 giai đoạn tương ứng với classifier và detecter :</p>
<p><strong>Giai đoạn 1 classifier</strong></p>
<ol>
<li>Chuẩn bị dữ liệu</li>
<li>Trích chọn đặc trưng</li>
<li>Build model</li>
<li>Đánh giá và cải thiện model</li>
</ol>
<p><strong>Giai đoạn 2  Detection</strong></p>
<ol>
<li>Xây dựng sliding window</li>
<li>Xây dựng NMS(non-maxinum-suppression)</li>
<li>Detecter</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="giai-đoạn-1-classifier">Giai đoạn 1 classifier<a href="#giai-đoạn-1-classifier" class="hash-link" aria-label="Direct link to Giai đoạn 1 classifier" title="Direct link to Giai đoạn 1 classifier">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-chuẩn-bị-dữ-liệu">1. Chuẩn bị dữ liệu<a href="#1-chuẩn-bị-dữ-liệu" class="hash-link" aria-label="Direct link to 1. Chuẩn bị dữ liệu" title="Direct link to 1. Chuẩn bị dữ liệu">​</a></h3>
<p>Dữ liệu chúng ta cần chuẩn bị gồm 2 phần . Một là positive sample ( gọi tắt là pos) là data pedestrian và chúng ta gắn label cho nó là 1. Thứ hai là negative sample (Neg) là dữ liệu không chứa pedestrian bạn có thể lấy như background, car, house ... và ta gắn nhãn là -1.(lưu ý nếu training trong opecv thì nhãn gắn bắt buộc là 1 và -1 ).</p>
<div class="language-py codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-py codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># image positive</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">path_pos </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> glob</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">glob</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;./pedestrians128x64/&quot;</span><span class="token operator" style="color:#393A34">+</span><span class="token string" style="color:#e3116c">&quot;*.ppm&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">subplots</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">figsize </span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    image1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> io</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">imread</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">path_pos</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">subplot</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">i </span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    io</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">imshow</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">image1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># image negative</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">path_neg </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> glob</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">glob</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;./pedestrians_neg/&quot;</span><span class="token operator" style="color:#393A34">+</span><span class="token string" style="color:#e3116c">&quot;*.jpg&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>Dữ liệu của ta gồm có 924 image pos có chiều (128, 64, 3) và ta sẽ tạo (15x50) image neg có chiều (128, 64, 3).</p>
<center><img width="600" height="300" src="/assets/images/pedestian1-a24ec58650d8d86276a1e9d77b9875be.jpg"></center>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-trích-chọn-đặc-trưng">2. Trích chọn đặc trưng<a href="#2-trích-chọn-đặc-trưng" class="hash-link" aria-label="Direct link to 2. Trích chọn đặc trưng" title="Direct link to 2. Trích chọn đặc trưng">​</a></h3>
<p>Ta sẽ dùng hog để trích chọn đặc trưng</p>
<div class="language-py codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-py codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">hog_feature</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">image</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    feature_hog </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> hog</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">image</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">orientations</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">9</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">pixels_per_cell</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">8</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">8</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cells_per_block</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">block_norm</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;L2&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> feature_hog</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#feature extraction for image pos    </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">X_pos </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">y_pos </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> path </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> path_pos </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    im </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> io</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">imread</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">as_grey</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    im_feature </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> hog_feature</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">im</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    X_pos</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">im_feature</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    y_pos</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#feature extraction for image neg</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">X_neg </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">y_neg </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">w </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">64</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">h </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">128</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> path </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> path_neg </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    im </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> io</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">imread</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">as_grey</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> j </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">15</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">random</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">randint</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">im</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">shape</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">w</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        y </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">random</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">randint</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">im</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">shape</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">h</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        im_crop </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> im</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">y</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">y</span><span class="token operator" style="color:#393A34">+</span><span class="token plain">h</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">x</span><span class="token operator" style="color:#393A34">+</span><span class="token plain">w</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        im_feature </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> hog_feature</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">im_crop</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        X_neg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">im_feature</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        y_neg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span></code></pre></div></div>
<p>Đầu tiên ta định nghĩa 1 function tính hog gồm các tham số <code>orientations=9,pixels_per_cell=(8,8),cells_per_block=(2,2),block_norm=&quot;L2&quot;</code>
Sau đó tính hog trên pos và neg sample
Cuối cùng ta stack pos và neg lại để chuẩn bị training</p>
<div class="language-py codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-py codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">X_pos </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">array</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">X_pos</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">X_neg </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">array</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">X_neg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">X_train </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">concatenate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">X_pos</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">X_neg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">y_pos </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">array</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">y_pos</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">y_neg </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">array</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">y_neg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">y_train </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">concatenate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">y_pos</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">y_neg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>Dữ liệu trining gồm có <code>X_traing</code> có shape (1674, 3780) gồm 1674 image và 3780 feature, <code>y_training</code> có shape là (1674,) gồm 2 giá trị 1 là pedestrian và -1 là non-pedestrian</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-build-model">3. Build model<a href="#3-build-model" class="hash-link" aria-label="Direct link to 3. Build model" title="Direct link to 3. Build model">​</a></h3>
<p>Chúng ta sẽ training model bằng thuật toán svm có trong thư viện sklearn.</p>
<div class="language-py codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-py codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> sklearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">svm </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> LinearSVC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> sklearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">metrics </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> classification_report</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">model </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> LinearSVC</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">C</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0.01</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">fit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">X_train</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">y_train</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">y_predict </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">predict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">X_train</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">classification_report</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">y_train</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">y_predict</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>Kết quả như sau :</p>
<center><img width="600" height="300" src="data:image/jpeg;base64,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"></center>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-đánh-giá-và-cải-thiện-model">4. Đánh giá và cải thiện model<a href="#4-đánh-giá-và-cải-thiện-model" class="hash-link" aria-label="Direct link to 4. Đánh giá và cải thiện model" title="Direct link to 4. Đánh giá và cải thiện model">​</a></h3>
<p>Amazing! kết quả accuracy = 100% . Quá cao phải ko. Nhưng đừng mừng vội vì data của chúng ta rất nhỏ và ta dùng toàn bộ data vào training mà ko chia ra data testing nên rất có thể bị overfiting. Khi đó model đưa vào hoạt động sẽ predict không tốt. Để tránh điều này
ta có thể thay đổi threshold  ( vì khi predict trên image lớn sẽ có rất nhiều non-pedestrian hơn là pedestrian).Ở trong sklearn mặc định <code>model.prediction</code> là 0.5 nên ta không thể nào thay đổi được nó. Ta chỉ có thể thay đổi qua <code>decision_function</code></p>
<div class="language-py codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-py codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> sklearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">metrics </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> precision_recall_curve</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> sklearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">model_selection </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> cross_val_predict</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">y_scores </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cross_val_predict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> X_train</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y_train</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> cv</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                             method</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;decision_function&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">precisions</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> recalls</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> thresholds </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> precision_recall_curve</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">y_train</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y_scores</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">plot_precision_recall_vs_threshold</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">precisions</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> recalls</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> thresholds</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">plot</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">thresholds</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> precisions</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;b--&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> label</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;Precision&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">plot</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">thresholds</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> recalls</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;g-&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> label</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;Recall&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xlabel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Threshold&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">legend</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">loc</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;center left&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ylim</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plot_precision_recall_vs_threshold</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">precisions</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> recalls</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> thresholds</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>Ta thấy khi threshold = 0 recall = 1 , khi recall = 0.8 thì threshold tăng lên 0.7</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="giai-đoạn-2--detecter">Giai đoạn 2  Detecter<a href="#giai-đoạn-2--detecter" class="hash-link" aria-label="Direct link to Giai đoạn 2  Detecter" title="Direct link to Giai đoạn 2  Detecter">​</a></h2>
<p>Bây giờ ta sẽ detecter pedestrian trên ảnh lớn.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-xây-dựng-sliding-window">1. Xây dựng sliding window<a href="#1-xây-dựng-sliding-window" class="hash-link" aria-label="Direct link to 1. Xây dựng sliding window" title="Direct link to 1. Xây dựng sliding window">​</a></h3>
<div class="language-py codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-py codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sliding_window</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">image</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">window_size</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">step_size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> y </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">image</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">shape</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">window_size</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">step_size</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> x </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">image</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">shape</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">window_size</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">step_size</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            roi </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> image</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">y</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">y</span><span class="token operator" style="color:#393A34">+</span><span class="token plain">window_size</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">x</span><span class="token operator" style="color:#393A34">+</span><span class="token plain">window_size</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">yield</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">roi</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>Function <code>sliding_window</code> có 3 para : 1 là <code>image</code> (là 1 ảnh xám), hai là <code>window_size</code> có chiều (mxn) là kích thước window trên image, cuối cùng là <code>step_size</code> có chiều (w,h) là stride theo ox,oy trên image.Giá trị trả về là vị trí (x,y) tương ứng là (top-left) và roi là slide window tương ứng.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-xây-dựng-nmsnon-maxinum-suppression">2. Xây dựng NMS(non-maxinum-suppression)<a href="#2-xây-dựng-nmsnon-maxinum-suppression" class="hash-link" aria-label="Direct link to 2. Xây dựng NMS(non-maxinum-suppression)" title="Direct link to 2. Xây dựng NMS(non-maxinum-suppression)">​</a></h3>
<p>Ta chỉ giữ lại 1 window trên 1 object mà thôi nên ta sẽ dùng NMS để loại bỏ các window còn lại, giữ lại window tối ưu nhất.Đầu tiên ta cần tính area overlap giữa 2 window.</p>
<div class="language-py codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-py codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">overlaping_area</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">detection_1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">detection_2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">#detection_1,detection_2 format [x_left_top,y_left_top,score,width,height]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    x_1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> detection_1</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    y_1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> detection_1</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    x_w_1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> detection_1</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> detection_1</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    y_h_1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> detection_1</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> detection_1</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    x_2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> detection_2</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    y_2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> detection_2</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    x_w_2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> detection_2</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> detection_2</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    y_h_2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> detection_2</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> detection_2</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">#tính overlap theo ox,oy .Nếu ko giao nhau trả về 0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    overlap_x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">max</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token builtin">min</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x_w_1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">x_w_2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token builtin">max</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x_1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">x_2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    overlap_y </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">max</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token builtin">min</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">y_h_1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">y_h_2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token builtin">max</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">y_1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">y_2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">#tính area overlap</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    overlap_area </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> overlap_x</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">overlap_y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">#tính total area hợp của 2 detection</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    total_area </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> detection_1</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">detection_1</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> detection_2</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">detection_2</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> overlap_area</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> overlap_area</span><span class="token operator" style="color:#393A34">/</span><span class="token builtin">float</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">total_area</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>Đây là bài toán tìm intersection giữa 2 rectangle bạn có thể search google xem cái giải quyết. Hàm overlaping_area sẽ trả về tỉ lệ overlap trên tổng area giữa 2 rectangle.
Tiếp theo chúng ta xây dựng làm NMS .</p>
<div class="language-py codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-py codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">nms</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">detections</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">threshold </span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0.4</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># decections format [x_left_top,y_left_top,score,width,height]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># nếu area overlap lớn hơn threshold thì sẽ remove detection nào có score nhỏ hơn</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token builtin">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">detections</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">==</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">#sort detection theo score</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    detections </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">sorted</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">detections</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">key </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">lambda</span><span class="token plain"> detections </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> detections</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">reverse </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">#create new detection</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    new_detections </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    new_detections</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">detections</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">del</span><span class="token plain"> detections</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> index</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">detection </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">enumerate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">detections</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> new_detection </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> new_detections</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> overlaping_area</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">detection</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">new_detection</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> threshold </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">#compare areaoverlap với threshold</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">del</span><span class="token plain"> detections</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">index</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">break</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            new_detections</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">detection</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">del</span><span class="token plain"> detections</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">index</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> new_detections</span><br></span></code></pre></div></div>
<p>Ý tưởng là chúng ta sẽ sort các detection theo score( decision_function) theo thứ tự giảm dần. Sau đó so sánh các detection với nhau, nếu area overlap hơn threshold thì ta sẽ giữ lại detection nào có score lớn hơn.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-detecter">3. Detecter<a href="#3-detecter" class="hash-link" aria-label="Direct link to 3. Detecter" title="Direct link to 3. Detecter">​</a></h3>
<p>Đến đây ta sẽ stack các function đã tạo lại với nhau thành một khối để detection trên ảnh lớn.</p>
<div class="language-py codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-py codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">image </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">imread</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;pedestrian.jpg&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">image_test </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cvtColor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">image</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">COLOR_BGR2GRAY</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">window_size </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">64</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">128</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">step_size </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">detections </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">downscale</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1.5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">scale </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> image_scale </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> pyramid_gaussian</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">image_test</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">downscale</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    scale </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> image_scale</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">shape</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> window_size</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">or</span><span class="token plain"> image_scale</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">shape</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> window_size</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">break</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">roi</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> sliding_window</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">image_scale</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">window_size</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">step_size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        feature </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> hog_feature</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">roi</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        predict </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">predict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">feature</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">reshape</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">3780</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        score </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">decision_function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">feature</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">reshape</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">3780</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">predict </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">and</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">score</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token number" style="color:#36acaa">0.5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            detections</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">round</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">score</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">window_size</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">window_size</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">detections </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> nms</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">detections</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">0.5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">_</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">w</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">h</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> detections </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">rectangle</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">image</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">y</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token operator" style="color:#393A34">+</span><span class="token plain">w</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">y</span><span class="token operator" style="color:#393A34">+</span><span class="token plain">h</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">255</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">imshow</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;roi&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">image</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">waitKey</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">destroyAllWindows</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>Giải thích code 1 tí:</p>
<ul>
<li>Vì window size cố định mà object mỗi image sẽ có kích thước khác nhau nên ta sẽ dùng 1 function tạo image pyramid, trong bài ta sẽ sử dụng pyramid_gaussian với downscale = 2 , có nghĩa sau mỗi lần chạy image sẽ giảm xuống 1 nữa</li>
<li>Để giảm bớt nhiễu ta sẽ sử dụng score &gt; 0.25</li>
<li>Ở đây có một nhược điểm là khi image downscale thì bounding box của ta sẽ không đổi làm cho object không được bao toàn bộ bởi bounding box mình định sẽ tăng kích thước bounding box bằng cách nhân cho nó 1 tỷ lệ bằng (downscale^scale) nhưng kết quả là bouding box quá to. Hiện giờ mình chưa tìm ra cách xử lý. Có thể xem minh họa ở hình dưới.</li>
</ul>
<center><img width="600" height="300" src="/assets/images/final1-d5aca5d2e472d79d3decd2645c1eb385.jpg"></center>
<center><img width="600" height="300" src="/assets/images/final2-7425dfefbe9788bbd8aa64fb81783a4c.jpg"></center>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="kết-luận-">Kết luận :<a href="#kết-luận-" class="hash-link" aria-label="Direct link to Kết luận :" title="Direct link to Kết luận :">​</a></h2>
<p>Thuật toán build model nhanh tuy nhiên có một nhược điểm là predict trên camera rất delay bởi vì ta sử dụng window search nên predict rất nhiều image dẫn đến tốn thời gian rất nhiều. Ngày nay người ta đã giải quyết được vấn đề này bằng cách sử dụng selective search có nghĩa là ko search windown toàn image nữa mà search có chọn lọc, những region proposal mà có nhiều khẳn năng có object nhất điển hình là thuật toán R-CNN.</p>
<p>Tham Khảo :</p>
<ul>
<li><a href="http://hanzratech.in/" target="_blank" rel="noopener noreferrer">http://hanzratech.in/</a></li>
<li><a href="https://pyimagesearch.com" target="_blank" rel="noopener noreferrer">https://pyimagesearch.com</a></li>
<li><a href="https://learnopencv.com" target="_blank" rel="noopener noreferrer">https://learnopencv.com</a></li>
</ul></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/blog/tags/opencv">opencv</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/blog/tags/python">python</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/blog/tags/computer-vision">computer vision</a></li></ul></div></div><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><a href="https://github.com/ThorPham/blog/2018-4-11-Nhận-diện -pedestrian-với-window-search/index.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/Tìm-hiểu-regression-trong-object-detection"><div class="pagination-nav__sublabel">Newer post</div><div class="pagination-nav__label">Tìm hiểu regression trong object detection</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/Tìm-hiểu-về-Word2Vec"><div class="pagination-nav__sublabel">Older post</div><div class="pagination-nav__label">Tìm hiểu về Word2Vec</div></a></nav></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Thorpham</div></div></div></footer></div>
</body>
</html>